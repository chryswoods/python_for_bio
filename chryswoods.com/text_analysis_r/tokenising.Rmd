---
title: "Text and Sentiment Analysis in R"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Tokenising

```{r}
install.packages("tidyverse")
install.packages("tidytext")
install.packages("textdata")
install.packages("gutenbergr")
install.packages("wordcloud")
install.packages("igraph")
install.packages("ggraph")
```

```{r}
library(tidyverse)
```

```{r}
text = c("To be, or not to be--that is the question:",
         "Whether 'tis nobler in the mind to suffer",
         "The slings and arrows of outrageous fortune",
         "Or to take arms against a sea of troubles",
         "And by opposing end them.")
```

```{r}
text <- tibble(line=1:5, text=text)
```

```{r}
tokens <- text %>% unnest_tokens(word, text)
```

```{r}
tokens %>% count(word, sort=TRUE)
```

## Reading text from a file

Difficult to get much from a small bit of text. Worth getting more, but will
need to read this from a file. Use `readLines` function.

```{r}
lines <- readLines("https://chryswoods.com/text_analysis_r/hamlet.txt")
text <- tibble(line=1:length(lines), text=lines)
```

```{r}
tokens <- text %>% unnest_tokens(word, text)
```

Dominated by "stop words"

```{r}
data(stop_words)
```

```{r}
important_tokens <- tokens %>% anti_join(stop_words)
```

(learn what an anti_join is)

```{r}
important_tokens %>% count(word, sort=TRUE)
```

Gets a good sense of what this text is about.


## Downloading texts

```{r}
library(gutenbergr)
```

```{r}
sherlock <- gutenberg_download(1661)
```

```{r}
sherlock %>% 
  unnest_tokens(word, text) %>%
  anti_join(stop_words) %>% 
  count(word, sort=TRUE)
```

```{r}
counts <- sherlock %>% 
            unnest_tokens(word, text) %>% 
            anti_join(stop_words) %>% 
            count(word, sort=TRUE) %>%
            filter(n > 75)
```

Plotting the more common words

Need to convert words from character strings to factors if we want to plot them.
Use the `reorder` function.

```{r}
counts <- counts %>% mutate(word = reorder(word, n))
```

(word is now a factor, rather than a character string. This means that it can be used
as a category in a bar chart)

```{r}
counts %>% ggplot(aes(n, word)) + geom_col() + labs(y=NULL)
```

(aes puts n on the x axis, word on the y axis, used a bar/column chart, and then
dropped the label on the y axis)

##Â EXERCISE

Do the same analysis of the Hound of the Baskervilles and create the same graph.

Hound of the Baskervilles

```{r}
hound <- gutenberg_download(2852)
hound <- hound %>% 
           unnest_tokens(word, text) %>%
           anti_join(stop_words)

counts <- hound %>% 
            count(word, sort=TRUE) %>%
            filter(n > 75)

counts <- counts %>% mutate(word = reorder(word, n))

counts %>% ggplot(aes(n, word)) + geom_col() + labs(y=NULL)
```

## [Previous](index.html) | [Next](sentiment.html)

